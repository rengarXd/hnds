<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
        <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
        <title>交易信息body</title>
        <link href="../../../css/Hui.css" rel="stylesheet" type="text/css" />
        <style type="text/css">
            .H_header_bg {
                background: #09a4de
            }
        </style>
    </head>
    <body>
        <div class="H-padding-vertical-bottom-10"></div>
        <div class="H-channel-title H-flexbox-horizontal H-theme-background-color-white H-vertical-middle H-border-vertical-bottom-after">
            <div class="H-channel-line H-theme-background-color-black H-padding-vertical-top-15 H-padding-horizontal-left-3  H-margin-horizontal-left-10"></div>
            <div class="H-channel-text H-theme-font-color-black H-flex-item H-font-size-18 H-theme-font-color-black H-padding-10 H-margin-horizontal-right-10 H-text-show-row-1">
                交易信息
            </div>
        </div>
        <!--交易信息-->
        <form id="forms">
            <div class="">
                <!--转让方 start-->
                <div class="H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after">
                    <span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">转让方：</span>
                    <input type="text" value="" id="transferor_name" name="transferor_name" class="H-textbox H-text-align-right H-theme-font-color-666 H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" data-rule="s" data-nullmsg="转让方姓名不能为空" data-errmsg="转让方姓名填写有误"
                    placeholder="转让方姓名" />
                </div>
                <!--转让方 end-->
                <!--证件类型 start-->
                <div class="H-text-list H-flexbox-horizontal H-theme-background-color-white H-border-vertical-bottom-margin-left-10-after H-vertical-middle H-touch-active" onclick="IDtype('type_option','transferor_certnumber');">
                    <div class="H-flex-item H-padding-horizontal-left-10 H-padding-horizontal-right-15 H-font-size-16 H-padding-vertical-both-12">
                        证件类型: <span class="H-padding-horizontal-both-12 H-float-right H-theme-font-color-666" id="type_option">点击选择证件类型</span>
                    </div>
                    <span class="H-icon H-padding-horizontal-right-5 H-display-block"> <i class="H-iconfont H-icon-arrow-right H-theme-font-color-ccc H-font-size-16 H-vertical-middle"></i> </span>
                </div>
                <!--证件类型 end-->
                <!--证件号码 start-->
                <div class="H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after">
                    <span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">证件号码：</span>
                    <input type="text" value="" id="transferor_certnumber" name="transferor_certnumber" class="H-textbox H-theme-font-color-666 H-text-align-right H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="转让方证件号码" />
                </div>
                <!--证件号码 end-->
                <!--联系电话 start-->
                <div class="H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after">
                    <span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">联系电话：</span>
                    <input type="text" value="" id="transferor_phone" name="transferor_phone" class="H-textbox H-vertical-align-middle H-theme-font-color-666 H-text-align-right H-vertical-middle H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12 H-font-size-16" data-rule="tm" data-nullmsg="联系电话不能为空" data-errmsg="联系电话填写错误"
                    placeholder="转让方联系电话" />
                </div>
                <!--联系电话 end-->
                <!--受让方 start-->
                <div class="H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after">
                    <span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">受让方：</span>
                    <input type="text" value="" id="purchaser_name" name="purchaser_name" class="H-textbox H-vertical-align-middle H-theme-font-color-666 H-vertical-middle H-text-align-right H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" data-rule="s" data-nullmsg="受让方姓名不能为空" data-errmsg="受让方姓名填写错误"
                    placeholder="受让方姓名" />
                </div>
                <!--受让方 end-->
                <!--证件类型 start-->
                <div class="H-text-list H-flexbox-horizontal  H-theme-background-color-white H-border-vertical-bottom-margin-left-10-after H-vertical-middle H-touch-active"  onclick="IDtype('purchaser_certype', 'purchaser_certnumber');">
                    <div class="H-flex-item H-padding-horizontal-left-10 H-padding-horizontal-right-15 H-font-size-16 H-padding-vertical-both-12">
                        证件类型: <span class="H-padding-horizontal-both-12 H-float-right H-theme-font-color-666" id="purchaser_certype" >点击选择证件类型</span>
                    </div>
                    <span class="H-icon H-padding-horizontal-right-5 H-display-block"> <i class="H-iconfont H-theme-font-color-666 H-icon-arrow-right H-theme-font-color-ccc H-font-size-16 H-vertical-middle"></i> </span>
                </div>
                <!--证件类型 end-->
                <!--证件号码 start-->
                <div class="H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after">
                    <span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">证件号码：</span>
                    <input type="text" value="" id="purchaser_certnumber" name="purchaser_certnumber" class="H-textbox H-theme-font-color-666 H-vertical-align-middle H-text-align-right H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="受让方证件号码" />
                </div>
                <!--证件号码 end-->
                <!--联系电话 start-->
                <div class="H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after">
                    <span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">联系电话：</span>
                    <input type="text" value="" id="purchaser_phone" name="purchaser_phone" class="H-textbox H-theme-font-color-666 H-vertical-align-middle H-vertical-middle H-text-align-right H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" data-rule="tm" data-nullmsg="联系电话不能为空" data-errmsg="联系电话填写有误"
                    placeholder="填写信息不能为空" />
                </div>
                <!--联系电话 end-->
                <!--交易类型 start-->
                <div class="H-text-list H-flexbox-horizontal  H-theme-background-color-white H-border-vertical-bottom-margin-left-10-after H-vertical-middle H-touch-active" tapmode onclick="payType('paytype');">
                    <div class="H-flex-item H-padding-horizontal-left-10 H-padding-horizontal-right-15 H-font-size-16 H-padding-vertical-both-12">
                        交易类型：<span class="H-padding-horizontal-both-12 H-float-right H-theme-font-color-666" id="paytype">点击选择交易类型</span>
                    </div>
                    <span class="H-icon H-padding-horizontal-right-5 H-display-block"> <i class="H-iconfont H-icon-arrow-right H-theme-font-color-ccc H-font-size-16 H-vertical-middle"></i> </span>
                </div>
                <!--交易类型 end-->
                <!--交易日期 start-->
                <div class="H-text-list H-flexbox-horizontal  H-theme-background-color-white H-border-vertical-bottom-margin-left-10-after H-vertical-middle H-touch-active" onclick="timePicker();">
                    <div class="H-flex-item H-padding-horizontal-left-10 H-padding-horizontal-right-15 H-font-size-16 H-padding-vertical-both-12">
                        交易时间：<span class="H-padding-horizontal-both-12 H-float-right H-theme-font-color-666" id="times">点击选择交易时间</span>
                    </div>
                    <span class="H-icon H-padding-horizontal-right-5 H-display-block"> <i class="H-iconfont H-icon-arrow-right H-theme-font-color-ccc H-font-size-16 H-vertical-middle"></i> </span>
                </div>
                <!--交易日期 end-->
            </div>
        </form>
        <div class="footer"></div>
        <footer class="H-footer H-padding-10 ">
            <button id="btn" name="xinzeng" class="H-margin-vertical-top-10 H-position-static H-button H-width-100-percent  H-font-size-15 H-outline-none H-padding-vertical-both-12 H-padding-horizontal-both-20 H-theme-background-color1 H-theme-font-color-white H-theme-border-color1 H-theme-background-color1-click H-theme-font-color1-click ">
                新增申请(1/3)
            </button>
        </footer>
        <script src="../../../script/H.js" type="text/javascript"></script>
        <script src="../../../script/zepto.min.js" type="text/javascript"></script>
        <script src="../../../script/tools/availdate-v1.0.2.js" type="text/javascript"></script>
        <script type="text/javascript">
            var assessinfo = null, assessinfo_id = null, type_option = null, purchaser_certype = null, paytype = null, dates = null, result = null;
            var retobj = null, user_id = null, uuid = null, edit;
            Zepto(function($) {
            });
            H.ready(function() {
                api.parseTapmode();
                edit = api.pageParam.edit;
                assessinfo_id = api.pageParam.assessinfo_id;
                if (edit) {
                    //继续编辑处理
                    api.getPrefs({
                        key : 'userinfo'
                    }, function(ret, err) {
                        retobj = eval('(' + ret.value + ')');
                        user_id = retobj[0].user_id;
                        uuid = retobj[0].uuid;
                        api.showProgress({
                            title : "拉取数据中..."
                        });
                        H.ajax(function(ret, err) {
                            //							$("#statuss").hide();
                            if (ret && ret.success) {
                                //								console.log("ret===" + JSON.stringify(ret));
                                var data = ret.data[0];
                                $("#transferor_name").val(data.transferor_name);
                                $("#type_option").text(data.zrf_zjlxnm);
                                //转让方证件类型
                                $("#type_option").attr("infoid001", data.transaction_type);
                                $("#transferor_certnumber").val(data.transferor_certnumber);
                                $("#transferor_phone").val(data.transferor_phone);
                                $("#purchaser_name").val(data.purchaser_name);
                                $("#purchaser_certype").attr("infoid001", data.purchaser_certype);
                                $("#paytype").attr("infoid002", data.transaction_type);
                                $("#purchaser_certype").text(data.srf_zjlxnm);
                                $("#purchaser_certnumber").val(data.purchaser_certnumber);
                                $("#purchaser_phone").val(data.purchaser_phone);
                                $("#paytype").text(data.infonm002);
                                $("#times").text(data.transaction_date.substring(-1, 10));
                                dates = data.transaction_date;
                                api.hideProgress();
                            } else if (ret && !ret.success) {
                                return $common.loginInvalid("../../");
                            }
                        }, 'appHouseDetail&funid=houses_assessinfo', 'post', {
                            values : {
                                user_id : user_id,
                                uuid : uuid,
                                assessinfo_id : assessinfo_id
                            }
                        });
                    });
                }
                //更新按钮信息
                if (assessinfo_id) {
                    $("button").text('更新申请(1/3)');
                }
                ac.form({
                    area : "#forms",
                    btn : "#btn", // 触发验证的按钮或者元素，支持标签，id，class，推荐使用id或者class
                    singleError : function(e, msg) {
                        // 自定义弹窗格式###############
                        alert(msg);
                    },
                    endSuccess : function(data) {
                        datas = data;
                        var value = {
                            "zrf_zjlxnm" : $("#type_option").html(),
                            "srf_zjlxnm" : $("#purchaser_certype").html(),
                            "transferor_name" : $("form input:first-child").val(),
                            "transferor_phone" : $("input[name='transferor_phone']").val(),
                            "transferor_certype" : $("#type_option").attr('infoid001'),
                            "transferor_certnumber" : $("input[name='transferor_certnumber']").val(),
                            "purchaser_certype" : $("#purchaser_certype").attr('infoid001'),
                            "transaction_type" : $("#paytype").attr('infoid002'),
                            "transaction_date" : dates
                        };
                        $.extend(datas, value);
                        post_data();
                        //                      alert(JSON.stringify(data));
                    }
                });
            });
            //受让方证件类型选择器
            function IDtype(IdName, CertNumber) {
                H.selAjax(function(ret, selet_option, infonm001) {
                    //					$('#' + IdName).attr("infoid001", "");
                    //alert("ret.buttonIndex==="+ret.buttonIndex+"selet_option.length==="+selet_option.length);
                    if (ret.buttonIndex <= selet_option.length) {
                        //							alert(ret.buttonIndex);
                        $('#' + IdName).attr("infoid001", selet_option[ret.buttonIndex - 1].infoid001).html(selet_option[ret.buttonIndex - 1].infonm001);
                        if (selet_option[ret.buttonIndex - 1].infonm001 == "身份证") {
							$("input[name=" + CertNumber + "]").attr({
								'data-rule' : 'idcard',
								'data-nullmsg' : selet_option[ret.buttonIndex - 1].infonm001 + "不能为空!",
								'data-errmsg' : selet_option[ret.buttonIndex - 1].infonm001 + '填写错误'
							});
						}else{
							$("input[name=" + CertNumber + "]").attr({
								'data-rule' : 'n',
								'data-nullmsg' : selet_option[ret.buttonIndex - 1].infonm001 + "不能为空!",
								'data-errmsg' : selet_option[ret.buttonIndex - 1].infonm001 + '填写错误'
							});
						}
                    }
                }, '001');
            }

            //交易类型选择器
            function payType(IdName) {
                H.selAjax(function(ret, selet_option) {
                    if (ret.buttonIndex <= selet_option.length) {
                        $('#' + IdName).attr("infoid002", selet_option[ret.buttonIndex - 1].infoid002).html(selet_option[ret.buttonIndex - 1].infonm002);
                    }
                }, '002');
            }

            //交易时间选择器
            function timePicker() {
                H.openTimePick(function(ret) {
                    //获取返回时间
                    $("#times").text(ret.year + '-' + ret.month + '-' + ret.day);
                    dates = ret.year + '-' + ret.month + '-' + ret.day;
                });
            }

            //处理返回结果
            function results(ret, callback) {
                if (ret.success) {
                    result = ret;
                    if ( typeof callback == 'function') {
                        callback();
                    } else if ( typeof callback == 'string') {
                        api.execScript({
                            name : 'rooms_header',
                            script : callback
                        });
                    }
                    api.hideProgress();
                } else if (ret.message) {
                    api.hideProgress();
                    H.toast(ret.message);
                } else {
                    api.hideProgress();
                    H.toast('连接');
                }
            }

            //更新或新增业务分发
            function get_PREFS() {
                //				console.log('assessinfo=====' + JSON.stringify(assessinfo));
                //1.4、已经新增
                if (assessinfo_id) {
                    //更新存量房信息
                    api.showProgress();
                    H.ajax(function(ret, err) {
                        var Transferee = 'Transferee(' + "'" + assessinfo_id + "'" + ',' + edit + ');';
                        results(ret, Transferee);
                    }, 'appHouseAssessUpdate&funid=houses_assessinfo&user_id=' + userinfo[0].user_id + '&uuid=' + userinfo[0].uuid + '&assessinfo_id=' + assessinfo_id, 'post', {
                        values : datas
                    });
                } else {
                    //新增存量房信息
                    H.ajax(function(ret, err) {
                        results(ret, function() {
                            assessinfo_id = result.data.assessinfo_id
                            //							H.toast(result.message);
                            H.setPrefs(function(ret, err) {
                                api.showProgress();
                                H.ajax(function(ret, err) {
                                    var Transferee = 'Transferee(' + "'" + assessinfo_id + "'" + ',' + edit + ');';
                                    results(ret, Transferee);
                                }, 'appHouseAssessUpdate&funid=houses_assessinfo&user_id=' + userinfo[0].user_id + '&uuid=' + userinfo[0].uuid + '&assessinfo_id=' + result.data.assessinfo_id, 'post', {
                                    values : datas
                                });
                                //console.log('setPref:rooms======' + JSON.stringify(ret));
                            }, 'rooms', JSON.stringify(result));
                        });
                    }, 'appHouseAssessAdd&funid=houses_assessinfo&user_id=' + userinfo[0].user_id + '&uuid=' + userinfo[0].uuid, 'post', {
                        values : datas
                    });
                }
            }

            //发送数据
            function post_data() {
                H.getUserPref(function() {
                    $("#type_option").attr('infoid') != "" && $("#purchaser_certype").attr('infoid') != "" && $("#paytype").attr('infoid') != "" && dates != null ? get_PREFS() : H.toast('您还有未选择的选项');
                });
            }
        </script>
    </body>
</html>