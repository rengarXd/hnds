<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>Hui</title>
		<link href="../../../css/Hui.css" rel="stylesheet" type="text/css" />
		<link rel="stylesheet" href="../../../css/fonts/iconfont.css" />
		<style type="text/css">
			.H_header_bg {
				background: #09a4de
			}
			.addh_active:active {
				background: #f5f5f5;
			}
		</style>
	</head>
	<body>
		<div class="H-padding-vertical-bottom-10"></div>
		<div class="H-flexbox-vertical" id="stap1">
			<div class="H-flex-item H-theme-background-color-white H-padding-10">
				<div class="H-padding-10">
					身份证示例
				</div>
				<div id="yulan">
					<img src="../../../image/sfz.jpg" style="width: 100%;" />
					<!--<img src="" id="yulan" style="width: 100%;"/>-->
				</div>
				<!--<div>
				<div class="H-padding-10">
				拍摄效果
				</div>
				<div>
				<img src="" id="ps" style="width: 100%"/>
				</div>
				</div>-->
				<div class="H-padding-10">
					点击加号拍照
				</div>
				<div class="addh_active H-padding-20 H-text-align-center H-border-both-after" onclick="openCamera();">
					<span class="iconfont icon-tianjia H-font-size-36 H-theme-font-color1"></span>
					<div style="display: none;">
						<!--<img src="" id="ps" style="width: 100%"/>-->
					</div>
				</div>
			</div>
			<div class="H-flex-item">
				<div class="footer"></div>
				<footer class="H-footer H-padding-10">
					<button onclick="nextPart();" class="H-margin-vertical-top-10 H-position-static H-button H-width-100-percent  H-font-size-15 H-outline-none H-padding-vertical-both-12 H-padding-horizontal-both-20 H-theme-background-color1 H-theme-font-color-white H-theme-border-color1 H-theme-background-color1-click H-theme-font-color1-click ">
						下一步(6/6)
					</button>
				</footer>
			</div>
		</div>
		<script type="text/javascript" src="../../../script/H.js"></script>
		<script type="text/javascript" src="../../../script/zepto.min.js"></script>
		<script type="text/javascript" src="../../../script/tools/availdate-v1.0.2.js"></script>
		<script type="text/javascript" src="../../../script/uploadimg/upImg.js"></script>
		<script type="text/javascript">
			var assessinfo = null, imageFilter = null, imageBrowser = null;
			var ImgWebUrl = 'http://218.29.85.98:8080/etax/fileAction.do';
			Zepto(function($) {
			});
			H.ready(function() {
				// 引入过滤压缩模块
				imageFilter = api.require("imageFilter");
				//引入图片预览模块
				imageBrowser = api.require('imageBrowser');
				H.getPrefs(function(ret, err) {
					assessinfo = eval('(' + ret.value + ')');
					console.log(JSON.stringify(ret));
				}, 'rooms');
			});
			function openWin() {
				api.execScript({
					name : 'rooms_payInfo_header',
					script : 'success();'
				});
			}

			//下一步
			function nextPart() {
				var imgurl = $("#yulan img").attr("src");
				// ################### 上传图片 #########################
				uploadFile(ImgWebUrl, imgurl, function(serverImg) {
					alert('ret====' + JSON.stringify(serverImg));
				});
			}

			// 上传图片
			// url：上传的url地址
			// data：上传的文件
			// callback：上传成功返回地址
			function uploadFile(url, data, callback) {
				H.imgAjax(function(ret, err) {
					if (ret) {
						callback(ret);
					}
				}, url, 'post', {
					values : {
						pagetype : "editgrid",
						funid : "sys_attach",
						nousercheck : "1",
						eventcode : "create",
						dataType : "byte",
						datafunid : assessinfo.data.assessinfo_id,
						dataid : assessinfo.data.datafunid,
						attach_name : "jxstar523602"
					},
					files : {
						attach_path : data,
					}
				});
			}

			//打开照相机获取
			function openCamera() {
				//api.getPicture
				i.openCamera({
					sourceType : 'camera',
					encodingType : 'jpg',
					mediaValue : 'pic',
					destinationType : 'url',
					allowEdit : false,
					quality : 50,
					targetWidth : 700,
					targetHeight : 400,
					saveToPhotoAlbum : false
				}, function(ret) {
					var returnUrl = ret.data;
					// 图片压缩
					i.imgCompress(returnUrl, 0.8, 0.8, i.getExt(returnUrl), function(compressImg) {
						i.getAttr(compressImg, function(ret) {
//							alert(ret.width+'======'+ret.height);
							if (ret.width > ret.height) {
								$("#yulan img").attr("src", compressImg);
								$("#yulan img").on("click", function() {
									var browerImgs = [];
									// 将图片追加到数组中
									browerImgs.push($("#yulan img").attr("src"));
									// 调用图片预览函数
									i.openImageBrowser(browerImgs);
								});
							} else {
								api.toast({
									msg : '照片必须是横向的,请重新拍照'
								});
							}
						});
					});
				}, '用户取消');
			}
		</script>
	</body>
</html>