<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>楼栋信息body</title>
		<link href="../../../css/Hui.css" rel="stylesheet" type="text/css" />
		<style type="text/css">
			.H_header_bg {
				background: #09a4de
			}
			input::-webkit-input-placeholder {
				color: #999999;
			}
		</style>
	</head>
	<body>
		<div class="H-padding-vertical-both-3 H-text-align-center H-border-both-after H-theme-font-color-ccc H-font-size-13">
			“*”为非必填项，如果需要则须填写。
		</div>
		<div class="H-channel-title H-flexbox-horizontal H-theme-background-color-white H-vertical-middle H-border-vertical-bottom-after">
			<div class="H-channel-line H-theme-background-color-black H-padding-vertical-top-15 H-padding-horizontal-left-3  H-margin-horizontal-left-10"></div>
			<div class="H-channel-text H-theme-font-color-black H-flex-item H-font-size-18 H-theme-font-color-black H-padding-10 H-margin-horizontal-right-10 H-text-show-row-1">
				楼栋信息
			</div>
		</div>
		<form id="forms">
			<div class="H-border-vertical-both-after">
				<div class="H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after">
					<span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">房产证号：</span>
					<input type="text" value="" id="fwcqzsh_fczh" name="fwcqzsh_fczh" class="H-textbox H-text-align-right H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" data-rule="*" data-nullmsg="房产证号不能为空" data-errmsg="房产证号填写错误"
					placeholder="填写房产证号" />
				</div>
				<div class="H-text-list H-flexbox-horizontal H-theme-background-color-white H-border-vertical-bottom-margin-left-10-after H-vertical-middle H-touch-active" onclick="timePicker();">
					<div class="H-flex-item H-padding-horizontal-left-10 H-padding-horizontal-right-15 H-font-size-16 H-padding-vertical-both-12">
						发证日期： <span class="H-padding-horizontal-both-12 H-float-right H-theme-font-color-666" data-id="times" dm="" id="times"></span>
					</div>
					<span class="H-icon H-padding-horizontal-right-5 H-display-block"> <i class="H-iconfont H-icon-arrow-right H-theme-font-color-ccc H-font-size-16 H-vertical-middle"></i> </span>
				</div>
				<div class="H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after">
					<span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">丘（地）号*：</span>
					<input type="text" id="c_qdh" name="c_qdh" value="" class="H-textbox H-text-align-right H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="请填写丘（地）号" />
				</div>
				<!--<div class="H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after">
				<span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">所在区域：</span>
				<input type="text" name="local_area" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" data-rule="*" data-nullmsg="信息不能为空" data-errmsg="填写信息不能为空" placeholder="填写所在区域"
				/>
				</div>-->
				<!--所在区域 start-->
				<div class="H-text-list H-flexbox-horizontal  H-theme-background-color-white H-border-vertical-bottom-margin-left-10-after H-vertical-middle H-touch-active" tapmode onclick="partType('xzqhsz_szqy');">
					<div class="H-flex-item H-padding-horizontal-left-10 H-padding-horizontal-right-15 H-font-size-16 H-padding-vertical-both-12">
						所在区域: <span class="H-padding-horizontal-both-12 H-float-right H-theme-font-color-666" data-id="xzqhsz_szqy" id="xzqhsz_szqy" ></span>
					</div>
					<span class="H-icon H-padding-horizontal-right-5 H-display-block"> <i class="H-iconfont H-icon-arrow-right H-theme-font-color-ccc H-font-size-16 H-vertical-middle"></i> </span>
				</div>
				<!--所在区域 end-->
				<div class="H-text-list H-flexbox-horizontal  H-theme-background-color-white H-border-vertical-bottom-margin-left-10-after H-vertical-middle H-touch-active" onclick="PingShuiFenQu();">
					<div class="H-flex-item H-padding-horizontal-left-10 H-padding-horizontal-right-15 H-font-size-16 H-padding-vertical-both-12">
						评税分区： <span class="H-padding-horizontal-both-12 H-float-right H-theme-font-color-666"  id="pingshui_type"></span>
					</div>
					<span class="H-icon H-padding-horizontal-right-5 H-display-block"> <i class="H-iconfont H-icon-arrow-right H-theme-font-color-ccc H-font-size-16 H-vertical-middle"></i> </span>
				</div>
				<div class="H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after">
					<span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">房屋坐落：</span>
					<input type="text" value="" id="tdfwdz_zcdzl" name="tdfwdz_zcdzl" class="H-textbox H-text-align-right H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" data-rule="*" data-nullmsg="房屋坐落不能为空" data-errmsg="房屋坐落填写错误"
					placeholder="填写房屋坐落" />
				</div>
				<div class="H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after">
					<span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">幢（楼）号：</span>
					<input type="text" name="fwzh_zh" id="fwzh_zh" value="" class="H-textbox H-text-align-right H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" data-rule="*" data-nullmsg="幢（楼）号不能为空" data-errmsg="幢（楼）号不能为空"
					placeholder="填写幢（楼）号" />
				</div>
				<div class="H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after">
					<span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">单元号：</span>
					<input type="text" name="dy_dy" id="dy_dy" value="" class="H-textbox H-text-align-right H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" data-rule="*" data-nullmsg="单元号不能为空" data-errmsg="单元号不能为空"
					placeholder="填写单元号" />
				</div>
				<div class="H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after">
					<span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">房号：</span>
					<input type="text" name="fh_bwjfh" id="fh_bwjfh" value="" class="H-textbox H-text-align-right H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" data-rule="*" data-nullmsg="房号不能为空" data-errmsg="房号不能为空"
					placeholder="填写户号" />
				</div>
			</div>
		</form>
		<footer class="H-footer H-padding-10 ">
			<button id="btn" class="H-margin-vertical-top-10 H-position-static H-button H-width-100-percent  H-font-size-15 H-outline-none H-padding-vertical-both-12 H-padding-horizontal-both-20 H-theme-background-color1 H-theme-font-color-white H-theme-border-color1 H-theme-background-color1-click H-theme-font-color1-click ">
				下一步(3/5)
			</button>
			<!--<button onclick="openNext();" class="H-margin-vertical-top-10 H-position-static H-button H-width-100-percent  H-font-size-15 H-outline-none H-padding-vertical-both-12 H-padding-horizontal-both-20 H-theme-background-color1 H-theme-font-color-white H-theme-border-color1 H-theme-background-color1-click H-theme-font-color1-click ">
			下一步(3/5)
			</button>-->
		</footer>
		<div id="jianpan" style="display:none;height: 400px;"></div>
		<script src="../../../script/H.js" type="text/javascript"></script>
		<script src="../../../script/zepto.min.js" type="text/javascript"></script>
		<script src="../../../script/tools/availdate-v1.0.2.js" type="text/javascript"></script>
		<script type="text/javascript">
			var datas = null, dates = null, userinfo = null, assessinfo_id = null;
			var retobj = null, user_id = null, uuid = null, type;
			H.ready(function() {
				api.parseTapmode();
				type = api.pageParam.type;
				assessinfo_id = api.pageParam.assessinfo_id;
				//获取焦点上弹页面
				//				$("input").focus(function(){
				//					$("#jianpan").show();
				//				});
				//				$("input").blur(function() {
				//					$("#jianpan").hide();
				//				});
				//初始化数据
				InitPref();
				//评税分区获取数据
				part();
				//提交信息及校验
				ac.form({
					area : "#forms",
					btn : "#btn", // 触发验证的按钮或者元素，支持标签，id，class，推荐使用id或者class
					singleError : function(e, msg) {
						// 自定义弹窗格式###############
						alert(msg);
					},
					endSuccess : function(data) {
						//						datas = data;
						var yanzheng = true;
						$("[data-id]").each(function() {
							var dm = $(this).attr('dm');
							if (dm == null || dm == "") {
								H.toast('有' + $(this).html() + '未填写项');
								//								console.log("dm===" + $(this).html());
								yanzheng = false;
							}
						});
						var value = {
							"c_qdh" : $("#c_qdh").val(),
							"c_fzrq" : $("#times").attr('dm'),
							"xzqhsz_szqy" : $("#xzqhsz_szqy").attr('dm'),
							"c_xqnm" : $("#pingshui_type").attr('xqdm')
						};
						datas = H.extendObj(data, value);
						//						_ajax();
						if (yanzheng) {
							//							alert(JSON.stringify(datas));
							_ajax();
						}
						//						alert(JSON.stringify(datas));
					}
				});
			});
			function openNext() {
				api.execScript({
					name : 'house_head',
					script : 'houseInfo(' + "'" + assessinfo_id + "'" + ');'
				});
			}

			//获取偏好值及渲染数据
			function InitPref() {
				if (type == 2) {
					//拉取数据更新操作
					edit();
				} else {
					api.getPrefs({
						key : 'userinfo'
					}, function(ret, err) {
						retobj = eval('(' + ret.value + ')');
						user_id = retobj[0].user_id;
						uuid = retobj[0].uuid;
						$("#btn").html('下一步（3/5）');
						typePref();
					});
				}
			}

			//获取所在区域、评税分区值
			function typePref() {
				api.getPrefs({
					key : 'psfqfwlx'
				}, function(ret, err) {
					var typ = eval('(' + ret.value + ')');
					$("#pingshui_type").html(typ.xqnm);
					$("#pingshui_type").attr('xqdm', typ.xqdm);
					//					alert('psfqfwlx====' + JSON.stringify(ret));
				});
				api.getPrefs({
					key : 'szqyType'
				}, function(ret, err) {
					var szq = eval('(' + ret.value + ')');
					//					alert(szq.szqynm);
					$("#xzqhsz_szqy").html(szq.szqynm);
					$("#xzqhsz_szqy").attr('dm', szq.szqycd);
					api.sendEvent({
						name : 'szqyInfo',
						extra : {
							szqy : szq.szqycd
						}
					});
					//					alert('szqyType===' + JSON.stringify(ret));
				});
			}

			//编辑方法
			function edit() {
				//继续编辑处理
				api.getPrefs({
					key : 'userinfo'
				}, function(ret, err) {
					retobj = eval('(' + ret.value + ')');
					user_id = retobj[0].user_id;
					uuid = retobj[0].uuid;
					api.showProgress({
						title : "拉取数据中..."
					});
					H.ajax(function(ret, err) {
						$("#statuss").hide();
						if (ret && ret.success) {
							//							console.log("ret===" + JSON.stringify(ret));
							var data = ret.data[0];
							api.sendEvent({
								name : 'szqyInfo',
								extra : {
									szqy : data.xzqhsz_szqy
								}
							});
							$("#fwcqzsh_fczh").val(data.fwcqzsh_fczh);
							$("#c_qdh").val(data.c_qdh);
							$("#times").text(data.c_fzrq);
							$("#times").attr("dm", data.c_fzrq);
							$("#tdfwdz_zcdzl").val(data.tdfwdz_zcdzl);
							$("#xzqhsz_szqy").text(data.szqynm);
							$("#xzqhsz_szqy").attr("dm", data.xzqhsz_szqy);
							$("#fwzh_zh").val(data.fwzh_zh);
							$("#pingshui_type").text(data.xqnm011);
							$("#pingshui_type").attr("xqdm", data.c_xqnm);
							$("#dy_dy").val(data.dy_dy);
							$("#fh_bwjfh").val(data.fh_bwjfh);
							api.hideProgress();
							//获取所在区域、评税分区值
							typePref();
						} else if (ret && !ret.success) {
							return $common.loginInvalid("../../");
						}
					}, 'appClfxsxxbDetail&funid=houses_clfxsxxbcheck', 'post', {
						values : {
							user_id : user_id,
							uuid : uuid,
							fwuuid : assessinfo_id
						}
					});
				});
			}

			//所在区域选择器
			function partType(IdName) {
				api.openWin({
					name : 'rooms_city_head',
					url : 'region/rooms_city_head.html'
				});
				//				H.selectAjax(function(ret, selet_option) {
				//					//					psfq = selet_option[ret.buttonIndex - 1].infoid010;
				//					//					$('#' + IdName).attr("infoid010", "");
				//					//					alert("ret.buttonIndex==="+ret.buttonIndex+"selet_option.length==="+selet_option.length);
				//					if (ret.buttonIndex <= selet_option.length) {
				//						$("#pingshui_type").html('');
				//						$("#pingshui_type").attr("xqdm", '');
				//						//						alert(selet_option[ret.buttonIndex - 1].szqycd);
				//						$('#' + IdName).attr("dm", selet_option[ret.buttonIndex - 1].szqycd).html(selet_option[ret.buttonIndex - 1].szqynm);
				//						api.sendEvent({
				//							name : 'szqyInfo',
				//							extra : {
				//								szqy : selet_option[ret.buttonIndex - 1].szqycd
				//							}
				//						});
				//					} else {
				//						$('#' + IdName).attr("dm", '').html('');
				//					}
				//				}, 'getParamSzqy&funid=param_dict', 'szqynm');
			}

			//打开评税分区
			function PingShuiFenQu() {
				//				console.log($("#local_area").attr("infoid010"));
				var psfq = $("#xzqhsz_szqy").attr("dm");
				psfq ? api.openWin({
					name : 'rooms_region_header',
					url : 'region/rooms_region_header.html',
					pageParam : {
						psfq : psfq
					},
					animation : {
						type : "none",
						duration : 0
					}
				}) : H.toast('请先选择所在区域');
			}

			//获取所选的评税分区
			function part() {
				api.addEventListener({
					name : 'szqyEvent'
				}, function(ret, err) {
					if (ret) {
						$("#xzqhsz_szqy").html(ret.value.szqynm);
						$("#xzqhsz_szqy").attr('dm', ret.value.szqycd);
					}
				});
				H.addEventListener(function(ret, err) {
					//alert('name===='+ret.value.typeval+'id===='+ret.value.typeid);
					//					console.log(JSON.stringify(ret));
					$("#pingshui_type").html(ret.value.xqnm);
					$("#pingshui_type").attr("xqdm", ret.value.xqdm);
				}, 'region');
			}

			//返回结果处理
			function results(ret) {
				api.hideProgress();
				if (ret.success) {
					result = ret;
					var houseInfo = 'houseInfo(' + "'" + assessinfo_id + "'" + ',' + type + ');';
					api.execScript({
						name : 'house_head',
						script : houseInfo
					});
					//                  api.execScript({
					//                      name : 'rooms_header',
					//                      script : 'buildInfo();'
					//                  });
				} else {
					H.toast(ret.message);
				}
			}

			//发证日期选择器
			function timePicker() {
				H.openTimePick(function(ret) {
					//获取返回时间
					$("#times").text(ret.year + '-' + ret.month + '-' + ret.day);
					dates = ret.year + '-' + ret.month + '-' + ret.day;
					$("#times").attr('dm', dates);
				});
			}

			function _ajax() {
				//1.4、已经登录
				//更新存量房信息
				H.ajax(function(ret, err) {
					results(ret);
				}, 'appClfxsxxbUpdate&funid=houses_clfxsxxbcheck&user_id=' + user_id + '&uuid=' + uuid + '&fwuuid=' + assessinfo_id, 'post', {
					values : datas
				});
			}

			//			function post_data() {
			//				_ajax();
			//			}
		</script>
	</body>
</html>