<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>二手房信息提交</title>
		<link href="../../../css/Hui.css" rel="stylesheet" type="text/css" />
		<style type="text/css">
			.H_header_bg {
				background: #09a4de
			}
			input::-webkit-input-placeholder {
				color: #999999;
			}
		</style>
	</head>
	<body>
		<div class="H-padding-vertical-both-3 H-text-align-center H-border-both-after H-theme-font-color-ccc H-font-size-13">
			“*”为非必填项，如果需要则须填写。
		</div>
		<div class="H-channel-title H-flexbox-horizontal H-theme-background-color-white H-vertical-middle H-border-vertical-bottom-after">
			<div class="H-channel-line H-theme-background-color-black H-padding-vertical-top-15 H-padding-horizontal-left-3  H-margin-horizontal-left-10"></div>
			<div class="H-channel-text H-theme-font-color-black H-flex-item H-font-size-18 H-theme-font-color-black H-padding-10 H-margin-horizontal-right-10 H-text-show-row-1" id="infos">
				卖方信息 <!--<span class="H-float-right H-font-size-15 H-theme-font-color-gray">共有人信息（选填）
				<input type="checkbox" id="gyr" onclick="gyrSwitch();" class="H-font-size-15 H-switch H-float-right H-position-relative H-theme-background-color-white H-theme-font-color7">
				</span>-->
			</div>
		</div>
		<!--交易信息-->
		<form id="forms">
			<div id="sale_html" class="">
				<!--转让方 start-->
				<div class="H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after">
					<span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">转让方：</span>
					<input type="text" value="" name="mfmc_nsrmc" class="H-textbox H-text-align-right H-theme-font-color-666 H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" data-rule="s" data-nullmsg="转让方姓名不能为空" data-errmsg="转让方姓名填写有误"
					placeholder="转让方姓名" />
				</div>
				<!--转让方 end-->
				<!--证件类型 start-->
				<div class="H-text-list H-flexbox-horizontal H-theme-background-color-white H-border-vertical-bottom-margin-left-10-after H-vertical-middle H-touch-active" onclick="IDtype('mfsfzjlx_zjlx','mfzjhm_zjhm');">
					<div class="H-flex-item H-padding-horizontal-both-10 H-font-size-16 H-padding-vertical-both-12">
						证件类型: <span class="H-padding-horizontal-left-12 H-float-right H-theme-font-color-666" data-id="mfsfzjlx_zjlx" dm="01001" id="mfsfzjlx_zjlx">居民身份证</span>
					</div>
					<span class="H-icon H-padding-horizontal-right-5 H-display-block"> <i class="H-iconfont H-icon-arrow-right H-theme-font-color-ccc H-font-size-16 H-vertical-middle"></i> </span>
				</div>
				<!--证件类型 end-->
				<!--证件号码 start-->
				<div class="H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after">
					<span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">证件号码：</span>
					<input type="text" value="" data-rule="idcard" data-nullmsg="身份证号不能为空" data-errmsg="身份证号填写错误" name="mfzjhm_zjhm" class="H-textbox H-theme-font-color-666 H-text-align-right H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="转让方证件号码" />
				</div>
				<!--证件号码 end-->
				<!--联系电话 start-->
				<div class="H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after">
					<span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">联系电话：</span>
					<input type="text" value="" name="mflxdh_lxdh" class="H-textbox H-vertical-align-middle H-theme-font-color-666 H-text-align-right H-vertical-middle H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12 H-font-size-16" data-rule="tm" data-nullmsg="联系电话不能为空" data-errmsg="联系电话填写错误"
					placeholder="转让方联系电话" />
				</div>
				<!--联系电话 end-->
				<!--国籍代码 start-->
				<div class="H-text-list H-flexbox-horizontal H-theme-background-color-white H-border-vertical-bottom-margin-left-10-after H-vertical-middle H-touch-active" tapmode onclick="select('mfgjjc','010');">
					<div class="H-flex-item H-padding-horizontal-both-10 H-font-size-16 H-padding-vertical-both-12">
						国籍: <span class="H-padding-horizontal-left-12 H-theme-font-color-666 H-float-right" mfgj_dm="156" id="mfgjjc">中国</span>
					</div>
					<span class="H-icon H-padding-horizontal-right-5 H-display-block"> <i class="H-iconfont H-icon-arrow-right H-theme-font-color-ccc H-font-size-16 H-vertical-middle"></i> </span>
				</div>
				<!--国籍代码 end-->
				<!--地址 start-->
				<div class="H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after">
					<span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">地址：</span>
					<input type="text" value="" name="g_mfdz" class="H-textbox H-vertical-align-middle H-theme-font-color-666 H-vertical-middle H-text-align-right H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" data-rule="s" data-nullmsg="地址不能为空" data-errmsg="地址填写错误"
					placeholder="填写地址" />
				</div>
				<!--地址 end-->
				<!--卖方所占份额 start-->
				<div class="H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after">
					<span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">所占份额（%）：</span>
					<input type="text" value="" name="g_mf_szfe_2" class="H-textbox H-vertical-align-middle H-theme-font-color-666 H-vertical-middle H-text-align-right H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" data-rule="n1-3" data-nullmsg="卖方所占份额不能为空" data-errmsg="卖方所占份额填写错误"
					placeholder="卖方所占份额" />
				</div>
				<!--卖方所占份额 end-->
			</div>
		</form>
		<div class="footer H-padding-10" id="gyrBtn" style="display: none;">
			<button  onclick="gyrxx();" class="H-margin-vertical-top-10 H-position-static H-button H-width-100-percent  H-font-size-15 H-outline-none H-padding-vertical-both-12 H-padding-horizontal-both-20 H-theme-background-color1 H-theme-font-color-white H-theme-border-color1 H-theme-background-color1-click H-theme-font-color1-click ">
				共有人信息（选填）
			</button>
		</div>
		<footer class="H-footer H-padding-10 ">
			<button id="btn" name="xinzeng" class="H-margin-vertical-top-10 H-position-static H-button H-width-100-percent  H-font-size-15 H-outline-none H-padding-vertical-both-12 H-padding-horizontal-both-20 H-theme-background-color1 H-theme-font-color-white H-theme-border-color1 H-theme-background-color1-click H-theme-font-color1-click ">
				下一步(1/5)
			</button>
			<!--<button onclick="openNext();" name="xinzeng" class="H-margin-vertical-top-10 H-position-static H-button H-width-100-percent  H-font-size-15 H-outline-none H-padding-vertical-both-12 H-padding-horizontal-both-20 H-theme-background-color1 H-theme-font-color-white H-theme-border-color1 H-theme-background-color1-click H-theme-font-color1-click ">
			下一步(1/5)
			</button>-->
		</footer>
		<script type="text/html" id="sale_detail_data">
			<!--转让方 start-->
			<div class="H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after">
			<span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">转让方：</span>
			<input type="text" value="{{ d.mfmc_nsrmc }}" name="mfmc_nsrmc" class="H-textbox H-text-align-right H-theme-font-color-666 H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" data-rule="*" data-nullmsg="转让方信息不能为空" data-errmsg="转让方信息填写有误"
			placeholder="转让方姓名" />
			</div>
			<!--转让方 end-->
			<!--证件类型 start-->
			<div class="H-text-list H-flexbox-horizontal H-theme-background-color-white H-border-vertical-bottom-margin-left-10-after H-vertical-middle H-touch-active" onclick="IDtype('mfsfzjlx_zjlx','transferor_certnumber');">
			<div class="H-flex-item H-padding-horizontal-both-10 H-font-size-16 H-padding-vertical-both-12">
			证件类型: <span class="H-padding-horizontal-left-12 H-float-right H-theme-font-color-666" dm="{{ d.mfsfzjlx_zjlx }}" id="mfsfzjlx_zjlx">{{ d.z_mfsfzjlxmc }}</span>
			</div>
			<span class="H-icon H-padding-horizontal-right-5 H-display-block"> <i class="H-iconfont H-icon-arrow-right H-theme-font-color-ccc H-font-size-16 H-vertical-middle"></i> </span>
			</div>
			<!--证件类型 end-->
			<!--证件号码 start-->
			<div class="H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after">
			<span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">证件号码：</span>
			<input type="text" value="{{ d.mfzjhm_zjhm }}" {{# if(d.z_gmfsfzjlxmc == "居民身份证") { }}data-rule="idcard" data-nullmsg="身份证号不能为空" data-errmsg="身份证号填写错误"{{# }else{ }}data-rule="s" data-nullmsg="{{ d.z_gmfsfzjlxmc }}不能为空" data-errmsg="{{ d.z_gmfsfzjlxmc }}填写错误"{{# } }} name="mfzjhm_zjhm" class="H-textbox H-theme-font-color-666 H-text-align-right H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="转让方证件号码" />
			</div>
			<!--证件号码 end-->
			<!--联系电话 start-->
			<div class="H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after">
			<span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">联系电话：</span>
			<input type="text" value="{{ d.mflxdh_lxdh }}" name="mflxdh_lxdh" class="H-textbox H-vertical-align-middle H-theme-font-color-666 H-text-align-right H-vertical-middle H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12 H-font-size-16" data-rule="tm" data-nullmsg="联系电话不能为空" data-errmsg="联系电话填写错误"
			placeholder="转让方联系电话" />
			</div>
			<!--联系电话 end-->
			<!--国籍代码 start-->
			<div class="H-text-list H-flexbox-horizontal H-theme-background-color-white H-border-vertical-bottom-margin-left-10-after H-vertical-middle H-touch-active" tapmode onclick="select('mfgjjc','010');">
			<div class="H-flex-item H-padding-horizontal-both-10 H-font-size-16 H-padding-vertical-both-12">
			国籍: <span class="H-padding-horizontal-left-12 H-theme-font-color-666 H-float-right" mfgj_dm="{{ d.g_mfgj }}" id="mfgjjc">{{ d.z_mfgjmc }}</span>
			</div>
			<span class="H-icon H-padding-horizontal-right-5 H-display-block"> <i class="H-iconfont H-icon-arrow-right H-theme-font-color-ccc H-font-size-16 H-vertical-middle"></i> </span>
			</div>
			<!--国籍代码 end-->
			<!--地址 start-->
			<div class="H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after">
			<span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">地址：</span>
			<input type="text" value="{{ d.g_mfdz }}" name="g_mfdz" class="H-textbox H-vertical-align-middle H-theme-font-color-666 H-vertical-middle H-text-align-right H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" data-rule="*" data-nullmsg="地址不能为空" data-errmsg="地址填写错误"
			placeholder="填写地址" />
			</div>
			<!--地址 end-->
			<!--卖方所占份额 start-->
				<div class="H-flexbox-horizontal H-border-vertical-bottom-margin-left-10-after">
					<span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">所占份额（%）：</span>
					<input type="text" value="{{ d.g_mf_szfe_2 }}" name="g_mf_szfe_2" class="H-textbox H-vertical-align-middle H-theme-font-color-666 H-vertical-middle H-text-align-right H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" data-rule="n1-3" data-nullmsg="卖方所占份额不能为空" data-errmsg="卖方所占份额填写错误"
					placeholder="卖方所占份额" />
				</div>
			<!--卖方所占份额 end-->
		</script>
		<script src="../../../script/H.js" type="text/javascript"></script>
		<script src="../../../script/zepto.min.js" type="text/javascript"></script>
		<script src="../../../script/tools/laytpl.js" type="text/javascript"></script>
		<script src="../../../script/tools/availdate-v1.0.2.js" type="text/javascript"></script>
		<script type="text/javascript">
			var type = null, gyr = true, assessinfo_id = null, type_option = null, result = null, datas = null;
			Zepto(function($) {
			});
			H.ready(function() {
				assessinfo_id = api.pageParam.assessinfo_id;
				type = api.pageParam.type;
				api.parseTapmode();
				InitPref();
				ac.form({
					area : "#forms",
					btn : "#btn", // 触发验证的按钮或者元素，支持标签，id，class，推荐使用id或者class
					singleError : function(e, msg) {
						// 自定义弹窗格式###############
						alert(msg);
					},
					endSuccess : function(data) {
						//						datas = data;
						var yanzheng = true;
						$("[data-id]").each(function() {
							var dm = $(this).attr('dm');
							if (dm == null || dm == "") {
								H.toast('有' + $(this).html() + '未填写项');
								//								console.log("dm===" + $(this).html());
								yanzheng = false;
							}
						});
						var value = {
							"mfsfzjlx_zjlx" : $("#mfsfzjlx_zjlx").attr("dm"),
							"z_mfsfzjlxmc" : $("#mfsfzjlx_zjlx").html(),
							"g_mfgj" : $("#mfgjjc").attr("mfgj_dm"),
							"z_mfgjmc" : $("#mfgjjc").html(),
							"user_id" : userinfo[0].user_id,
							"uuid" : userinfo[0].uuid
						};
						datas = H.extendObj(data, value);
						//						post_data();
						if (yanzheng) {
							//							alert(JSON.stringify(datas));
							get_PREFS();
						}
						//						alert(JSON.stringify(datas));
					}
				});
			});
			function openNext() {
				api.execScript({
					name : 'house_head',
					script : 'Transferee(' + "'" + assessinfo_id + "'" + ');'
				});
			}

			function gyrSwitch() {
				//				gyr = false;
				if (gyr) {
					$("#gyrBtn").show();
					gyr = false;
				} else {
					$("#gyrBtn").hide();
					gyr = true;
				}
			}

			function gyrxx() {
				api.openWin({
					name : 'gyr_list_header',
					url : './gyrxx/gyr_list_header.html',
					pageParam : {
						assessinfo_id : assessinfo_id,
						mflx : '0'
					}
				});
			}

			//证件类型选择器*
			function IDtype(IdName, CertNumber) {
				H.selectAjax(function(ret, selet_option) {
					//					$('#' + IdName).attr("infoid001", "");
					//alert("ret.buttonIndex==="+ret.buttonIndex+"selet_option.length==="+selet_option.length);
					if (ret.buttonIndex <= selet_option.length) {
						//							alert(ret.buttonIndex);
						$('#' + IdName).attr("dm", selet_option[ret.buttonIndex - 1].zjlxcd).html(selet_option[ret.buttonIndex - 1].zjlxnm);
						if (selet_option[ret.buttonIndex - 1].zjlxnm == "身份证") {
							$("input[name=" + CertNumber + "]").attr({
								'data-rule' : 'idcard',
								'data-nullmsg' : selet_option[ret.buttonIndex - 1].zjlxnm + "不能为空!",
								'data-errmsg' : selet_option[ret.buttonIndex - 1].zjlxnm + '填写错误'
							});
						} else {
							$("input[name=" + CertNumber + "]").attr({
								'data-rule' : 'n',
								'data-nullmsg' : selet_option[ret.buttonIndex - 1].zjlxnm + "不能为空!",
								'data-errmsg' : selet_option[ret.buttonIndex - 1].zjlxnm + '填写错误'
							});
						}
					}
				}, 'getParamDict&funid=param_dict', 'zjlxnm');
			}

			//			function gyrxx() {
			//				api.openWin({
			//					name : 'sale_gyr_head',
			//					url : './gyrxx/sale_gyr_head.html',
			//					pageParam : {
			//						assessinfo_id : assessinfo_id,
			//						mflx : '0'
			//					}
			//				});
			//			}
			function edit() {
				//继续编辑处理
				api.showProgress({
					title : "拉取数据中..."
				});
				H.ajax(function(ret, err) {
					$("#statuss").hide();
					if (ret && ret.success) {
						console.log("ret===" + JSON.stringify(ret));
						var data = ret.data[0];
						var tpl = document.getElementById('sale_detail_data').innerHTML;
						//方式一：异步渲染（推荐）
						laytpl(tpl).render(data, function(render) {
							api.hideProgress();
							document.getElementById('sale_html').innerHTML = render;
						});
						api.hideProgress();
					} else if (ret && !ret.success) {
						return $common.loginInvalid("../../../");
					}
				}, 'appClfxsxxbDetail&funid=houses_clfxsxxbcheck', 'post', {
					values : {
						"user_id" : userinfo[0].user_id,
						"uuid" : userinfo[0].uuid,
						"fwuuid" : assessinfo_id
					}
				});
			}

			//获取偏好值及渲染数据
			function InitPref() {
				H.getUserPref(function() {
					if (type == 2) {
						//拉取数据更新操作
						edit();
					} else {
						$("#btn").html('新增申请');
					}
				});
			}

			//国籍选择器
			function select(IdName) {
				H.dkfpAjax(function(ret, selet_option) {
					//$('#' + IdName).attr("gjhdqsz_dm", "");
					//alert("ret.buttonIndex==="+ret.buttonIndex+"selet_option.length==="+selet_option.length);
					if (ret.buttonIndex <= selet_option.length) {
						//							alert(ret.buttonIndex);
						$('#' + IdName).attr("mfgj_dm", selet_option[ret.buttonIndex - 1].gjhdqsz_dm).html(selet_option[ret.buttonIndex - 1].gjhdqjc);
					}
				}, 'getGoldTax010', 'gjhdqjc');
			}

			//请求结果处理
			function results(ret, callback) {
				if (ret.success) {
					result = ret;
					if ( typeof callback == 'function') {
						callback();
					} else if ( typeof callback == 'string') {
						api.execScript({
							name : 'house_head',
							script : callback
						});
					}
					api.hideProgress();
				} else if (ret.message) {
					api.hideProgress();
					H.toast(ret.message);
				} else {
					api.hideProgress();
					H.toast(ret);
				}
			}

			//提交本页面信息
			function get_PREFS() {
				//1.4、已经新增
				//更新存量房信息
				if (type == 2) {
					api.showProgress();
					H.ajax(function(ret, err) {
						var Transferee = 'Transferee(' + "'" + assessinfo_id + "'" + ');';
						//						console.log(Transferee);
						results(ret, Transferee);
					}, 'appClfxsxxbUpdate&funid=houses_clfxsxxbcheck&fwuuid=' + assessinfo_id, 'post', {
						values : datas
					});
				} else {
					api.showProgress();
					H.ajax(function(ret, err) {
						assessinfo_id = ret.data.fwuuid;
						var Transferee = 'Transferee(' + "'" + assessinfo_id + "'" + ');';
						//						console.log(Transferee);
						results(ret, Transferee);
					}, 'appClfxsxxbAdd&funid=houses_clfxsxxbcheck', 'post', {
						values : datas
					});
				}
				//				var mfgj_dm = $("#mfgjjc").attr("mfgj_dm");
				//				if (mfgj_dm && mfgj_dm !== "" && $("#mfgjjc").html() !== "") {
				//					api.showProgress();
				//					H.ajax(function(ret, err) {
				//						var Transferee = 'Transferee(' + "'" + assessinfo_id + "'" + ');';
				//						//						console.log(Transferee);
				//						results(ret, Transferee);
				//					}, 'appSaleRecordUpdate&funid=wbjh_clfxsxxb&fwuuid=' + assessinfo_id, 'post', {
				//						values : datas
				//					});
				//				} else {
				//					H.toast('请选择国籍');
				//				}
			}
		</script>
	</body>
</html>