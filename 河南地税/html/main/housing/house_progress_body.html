<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>二手房信息提交list</title>
		<link href="../../../css/Hui.css" rel="stylesheet" type="text/css" />
		<link href="../../../css/fonts/iconfont.css" rel="stylesheet" type="text/css" />
		<link href="../../../css/animate/animate.min.css" rel="stylesheet" type="text/css" />
		<style>
			.h-status {
				width: 42px;
				height: 41px;
				background: rgb(34, 188, 189);
				border-radius: 42px;
				color: #fff;
				text-align: center;
				font-size: 14px;
				padding: 6px;
				margin: 8px;
				line-height: 42px;
			}
			.b_style {
				width: 40px;
				height: 20px;
				background: #f5f5f5;
				border: 1px solid #ddd;
				font-size: 12px;
				color: #AFAFAF;
				border-radius: 4px;
				float: right;
				/* width: 20px; */
				margin-top: 15px;
				margin-right: 20px;
			}
		</style>
	</head>
	<body>
		<div class="H-padding-vertical-top-10"></div>
		<div class="H-padding-10" tapmode onclick="openWin('house_head','house_head.html');">
			<button class="H-position-static H-button H-width-100-percent  H-font-size-15 H-outline-none H-padding-vertical-both-12 H-padding-horizontal-both-20 H-theme-background-color1 H-theme-font-color-white H-theme-border-color1 H-theme-background-color1-click H-theme-font-color1-click ">
				新建信息提交
			</button>
		</div>
		<!--<div class="H-position-absolute H-position-center-all" id="statuss" style="display: none">
		<div class="H-font-size-14 H-text-align-center">
		<i class="iconfont icon-jindu H-font-size-32 H-theme-font-color1"></i>
		<div class="H-theme-font-color1">
		受理进度为空
		</div>
		</div>
		</div>-->
		<div id="progress_data_body" class="H-padding-horizontal-both-10">
			<div id="loading" class="H-center-all H-padding-20">
				<img src="../../../image/loading_more.gif" width="30" />
			</div>
		</div>
		<div class="H-padding-vertical-top-10"></div>
		<script id="progress_data" type="text/html">
			{{# for(var i = 0, len = d.data.length; i < len; i++){ }}
			<div class="H-margin-vertical-both-3  H-flexbox-horizontal H-theme-background-color-white animated fadeIn">
			{{# if(d.data[i].approve_state=="退回编辑"){ }}
			<div class="H-padding-vertical-both-10 h-status">
			{{ d.data[i].approve_state }}
			</div>
			<div class="H-flex-item H-font-size-12 H-theme-font-color-666 H-padding-8"  tapmode="H-active" onclick="show('{{ d.data[i].fwuuid }}');">
			转让方：{{ d.data[i].mfmc_nsrmc }}<br />
			受让方：{{ d.data[i].gmfmc_csfnsrmc }}<br />
			房产证号：{{ d.data[i].fwcqzsh_fczh }}<br />
			日期：{{ d.data[i].add_date }}
			</div>
			<div class="H-float-right">
			<button class="b_style" tapmode onclick="showFunction('{{ d.data[i].fwuuid }}', '{{ d.data[i].transferor_certnumber }}');">编辑</button><br/>
			<button class="b_style" tapmode onclick="del('{{ d.data[i].fwuuid }}')">删除</button>
			</div>
			{{# }else if(d.data[i].approve_state=="未提交"){ }}
			<div class="H-padding-vertical-both-10 h-status" style="background: #31c27c">
			{{ d.data[i].approve_state }}
			</div>
			<div class="H-flex-item H-font-size-12 H-theme-font-color-666 H-padding-8" tapmode="H-active" onclick="show('{{ d.data[i].fwuuid }}');">
			转让方：{{ d.data[i].mfmc_nsrmc }}<br />
			受让方：{{ d.data[i].gmfmc_csfnsrmc }}<br />
			房产证号：{{ d.data[i].fwcqzsh_fczh }}<br />
			日期：{{ d.data[i].add_date }}
			</div>
			<div class="H-float-right">
			<button class="b_style" tapmode onclick="showFunction('{{ d.data[i].fwuuid }}', '{{ d.data[i].transferor_certnumber }}');">编辑</button><br/>
			<button class="b_style" tapmode onclick="del('{{ d.data[i].fwuuid }}')">删除</button>
			</div>
			{{# }else if(d.data[i].approve_state=="受理中"){ }}
			<div class="H-padding-vertical-both-10 h-status" style="background: #00aeef">
			{{ d.data[i].approve_state }}
			</div>
			<div class="H-flex-item H-font-size-12 H-theme-font-color-666 H-padding-8"  tapmode="H-active" onclick="show('{{ d.data[i].fwuuid }}');">
			转让方：{{ d.data[i].mfmc_nsrmc }}<br />
			受让方：{{ d.data[i].gmfmc_csfnsrmc }}<br />
			房产证号：{{ d.data[i].fwcqzsh_fczh }}<br />
			日期：{{ d.data[i].add_date }}
			</div>
			{{# }else if(d.data[i].approve_state=="已审验"){ }}
			<div class="H-padding-vertical-both-10 h-status" style="background: #89d043">
			{{ d.data[i].approve_state }}
			</div>
			<div class="H-flex-item H-font-size-12 H-theme-font-color-666 H-padding-8"  tapmode="H-active" onclick="show('{{ d.data[i].fwuuid }}');">
			转让方：{{ d.data[i].mfmc_nsrmc }}<br />
			受让方：{{ d.data[i].gmfmc_csfnsrmc }}<br />
			房产证号：{{ d.data[i].fwcqzsh_fczh }}<br />
			日期：{{ d.data[i].add_date }}
			</div>
			{{# } }}
			</div>
			{{# } }}
		</script>
		<script src="../../../script/ajax/hnds.js" type="text/javascript"></script>
		<script src="../../../script/tools/laytpl.js" type="text/javascript"></script>
		<script src="../../../script/common.js" type="text/javascript"></script>
		<script type="text/javascript">
			var user_id = null, uuid = null, retobj = null;
			apiready = function() {
				api.parseTapmode();
				//初始化用户信息
				initUserInfo();
				//初始化下拉
				initRefreshHeaderInfo();
				//监听页面刷新
				api.addEventListener({
					name : 'roomReload'
				}, function(ret, err) {
					location.reload();
				});
			};
			//初始化下拉
			function initRefreshHeaderInfo() {
				api.setRefreshHeaderInfo({
					bgColor : "#ffffff"
				}, function(ret, err) {
					ajax();
				});
			}

			function ajax() {
				$ds.nodata(function(ret, err) {
					//				console.log("返回step2,ret=="+JSON.stringify(ret));
					api.refreshHeaderLoadDone();
					//						$("#statuss").hide();
					if (ret && ret.success) {
						if (undefined == ret.data.length) {
							//							console.log("无数据");
							var html = '<div class="H-position-absolute H-position-center-all" id="statuss"><div class="H-font-size-14 H-text-align-center"><i class="iconfont icon-jindu H-font-size-32 H-theme-font-color-999"></i><div class="H-theme-font-color-999">暂无申请记录</div></div></div>';
							//$('#progress_data_body').html(html);
							document.getElementById('progress_data_body').innerHTML = html;
						} else {
							var tpl = document.getElementById("progress_data").innerHTML;
							laytpl(tpl).render(ret, function(render) {
								document.getElementById("progress_data_body").innerHTML = render;
							});
						}
					} else if (ret && !ret.success) {
						return $common.loginInvalid("../../");
					}
				}, 'appClfxsxxbList&funid=houses_clfxsxxbcheck', 'post', {
					values : {
						user_id : user_id,
						uuid : uuid
						//						type : 3
					}
				}, 'progress_data_body');
			}

			//初始化用户信息
			function initUserInfo() {
				api.getPrefs({
					key : 'userinfo'
				}, function(ret, err) {
					retobj = eval('(' + ret.value + ')');
					user_id = retobj[0].user_id;
					uuid = retobj[0].uuid;
					ajax();
				});
			}

			//打开 新增申请
			function openWin(name, url) {
				api.getPrefs({
					key : 'jiaoyan'
				}, function(ret, err) {
					//					console.log('jiaoyan===' + ret.value);
					if (ret && ret.value) {
						var jy = eval('(' + ret.value + ')');
						if (jy.success == true) {
							api.openWin({
								name : name,
								url : url,
								pageParam : {
									type : 1
								},
								animation : {
									type : 'reveal',
									subType : 'from_right',
									duration : 100
								}
							});
						} else {
							alert(jy.message + '房屋暂不能评估，不能进行二手房信息申请，请等待相关部门维护！');
						}
					} else {
						api.toast({
							msg : '请先进行房屋校验！'
						});
					}
				});
			}

			//撤销申请
			function del(id) {
				//				console.log('id==' + id);
				api.confirm({
					title : "温馨提示",
					msg : "撤销此申请将不可恢复，确定要撤销吗？",
					buttons : ['确定', '取消']
				}, function(ret, err) {
					var index = ret.buttonIndex;
					if (index == 1) {
						$ds.ajax(function(ret, err) {
							window.location.reload();
						}, 'deleteClfxsxxb&funid=houses_clfxsxxbcheck', 'post', {
							values : {
								user_id : user_id,
								uuid : uuid,
								fwuuid : id
							}
						});
					}
				});
			}

			//编辑更新
			function showFunction(assessinfo_id, transferor_certnumber) {
				var syst = api.systemType;
				if (syst != "ios") {
					delay = 200;
				} else {
					delay = 0;
				}
				api.openWin({
					name : 'house_head',
					url : 'house_head.html',
					pageParam : {
						assessinfo_id : assessinfo_id,
						type : 2
					},
					delay : delay,
					animation : {
						type : 'reveal',
						subType : 'from_right',
						duration : 0
					}
				});
				setTimeout(function() {
					location.reload();
				}, 2000);
			}

			function show(assessinfo_id) {
				var sys = api.systemType;
				//安卓加载延迟设置
				sys != "ios" ? delay = 200 : delay = 0;
				api.openWin({
					name : 'progress_show_head',
					url : '../progress/progress_show_head.html',
					pageParam : {
						assessinfo_id : assessinfo_id
					},
					delay : delay,
					animation : {
						type : 'reveal',
						subType : 'from_right',
						duration : 100
					}
				});
			}
		</script>
	</body>
</html>