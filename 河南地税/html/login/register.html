<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<title>注册页面</title>
		<link rel="stylesheet" type="text/css" href="../../css/Hui.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/fonts/iconfont.css"/>
		<style>
			html {
				background-color: #ffffff;
			}
			body {
				background-color: #ffffff;
			}
			span {
				color: #3F3F3F;
			}
			.H_header_bg {
				background: #0193E8
			}
			.H-theme-background-color1 {
				background-color: #1ECFF5;
			}
			.H-theme-border-color1:active {
				background: #0fc9f1;
				border: 1px solid #0fc9f1;
			}
			.error {
				position: fixed;
				top: 20px;
				right: 20px;
				color: #ffffff;
				font-size: 20px;
			}
		</style>
	</head>
	<body>
		<header class="H-header H_header_bg" id="index_header">
			<div class="H-header-title H-text-align-center H-theme-font-color-white H-center-all"></div>
		</header>
		<img class="log" src="../../image/register_header.png" style="width: 100%"/>
		<span class="iconfont icon-gb error" onclick="gb();"></span>
		<div style="margin: 0px 25px 25px 25px;" id="availdate">
			<p class="H-padding-horizontal-both-10 H-font-size-12"style="color: #C9C9C9">
				请您如实填写下列信息
			</p>
			<div class="H-flexbox-horizontal H-border-vertical-both-after">
				<span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">用户名：</span>
				<input id="user_code" type="text" data-rule="*6-16" data-nullmsg="用户名不能为空" data-errmsg="用户名为6-16位字符" data-sucmsg="" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="6-16位字符">
			</div>
			<div class="H-flexbox-horizontal H-border-vertical-bottom-after">
				<span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">密码：</span>
				<input id="user_pwd" type="password" data-rule="*6-16" data-nullmsg="密码不能为空" data-errmsg="密码为6-16位字符串" data-sucmsg="" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="6位以上字符">
			</div>
			<div class="H-text-list H-flexbox-horizontal  H-theme-background-color-white H-border-vertical-bottom-margin-left-10-after H-vertical-middle H-touch-active" onclick="select();">
				<div class="H-flex-item H-padding-horizontal-left-10 H-padding-horizontal-right-15 H-font-size-16 H-padding-vertical-both-12">
					纳税身份: <span class="H-padding-horizontal-both-12" id="cole_no">一般纳税人</span>
				</div >
				<span class="H-icon H-padding-horizontal-right-5 H-display-block"> <i class="H-iconfont H-icon-arrow-right H-theme-font-color-ccc H-font-size-14 H-vertical-middle"></i> </span>
			</div>
			<div class="H-flexbox-horizontal H-border-vertical-bottom-after">
				<span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">姓名：</span>
				<input id="user_name" type="text" data-rule="cname" data-nullmsg="真实姓名不能为空" data-errmsg="真实姓名错误" data-sucmsg="" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="请输入真实姓名" >
			</div>
			<div class="H-flexbox-horizontal H-border-vertical-bottom-after">
				<span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">手机号码：</span>
				<input id="mob_code" type="tel" data-rule="m" data-nullmsg="手机号码不能为空" data-errmsg="手机号码格式错误" data-sucmsg=""  class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="请输入手机号码" >
			</div>
			<div class="H-flexbox-horizontal H-border-vertical-bottom-after">
				<span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">邮箱：</span>
				<input id="email" type="email" data-rule="e" data-nullmsg="" data-errmsg="邮箱地址格式不对" data-sucmsg="" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="请输入邮箱" >
			</div>
			<button id="register" class="H-margin-vertical-top-10 H-button H-width-100-percent  H-font-size-13 H-outline-none H-padding-vertical-both-12 H-padding-horizontal-both-20 H-theme-background-color1 H-theme-font-color-white H-theme-border-color1 H-theme-background-color1-click H-theme-font-color1-click H-border-radius-3" style="border-color: #1ECFF5">
				注&nbsp;&nbsp;&nbsp;册
			</button>
		</div>
		<script type="text/javascript" src="../../script/H.js"></script>
		<script type="text/javascript" src="../../script/zepto.min.js"></script>
		<script type="text/javascript" src="../../script/tools/availdate-v1.0.2.js"></script>
		<script type="text/javascript">
			var user_name = null, user_password = null;
			H.ready(function() {
				ac.form({
					area : "#availdate",
					btn : "#register", // 触发验证的按钮或者元素，支持标签，id，class，推荐使用id或者class
					startCheck : function() {
						// 自定义验证之前执行函数
						//alert("开始验证啦！一般用于加载！");
					},
					singleError : function(e, msg) {
						// 自定义弹窗格式###############
						api.alert({
							title : "温馨提示",
							msg : msg
						}, function(ret, err) {
						});
					},
					singleSuccess : function(e, msg) {
						// 验证单个成功之后提示信息
						//alert("我自己通过验证了！别人我不知道！");
					},
					endSuccess : function(data) {
						var cole_no = $("#cole_no").attr("types");
						var tel = $("#mob_code").val();
						var user_realname = $("#user_name").val();
						var email = $("#email").val();
						var user_password = $("#user_pwd").val();
						api.showProgress({
							title : '注册中',
							text : '请稍等....',
						});
						//post请求
						api.ajax({
							url : window.serverUrl + 'register&funid=sys_user',
							method : 'post',
							data : {
								values : {
									user_code : user_name,
									user_pwd : user_password,
									role_no : cole_no,
									user_name : user_realname,
									mob_code : tel,
									email : email
								}
							}
						}, function(ret, err) {
//							console.log(JSON.stringify(ret));
//							console.log(JSON.stringify(err));
							api.hideProgress();
							var systemType = api.systemType;
							if (systemType == "ios") {
								var rets = eval('(' + err.body + ')');
								
								if (rets && rets.success == true) {
									api.toast({
										msg : '注册成功，即将跳转登录页面'
									});
									api.openWin({
										name : 'login_body',
										url : '../login/login_body.html'
									});
									//1.登录成功之后延时关闭自已
									setTimeout(function() {
										H.closeWin();
									}, 1200);
								} else if (err) {
									api.toast({
										msg : '注册失败'
									});
								}
							} else {
								
								if (ret && ret.success == true) {
									
									alert("注册成功");
									api.openWin({
										name : 'login_body',
										url : '../login/login_body.html'
									});
									//1.登录成功之后延时关闭自已
									setTimeout(function() {
										H.closeWin();
									}, 1200);
								} else if (err) {
									api.toast({
										msg : '注册失败'
									});
								}
							}
						});
					}
				});
			});
			//当输入密码框获取焦点时
			$("#user_pwd").focus(function() {
				user_name = $("#user_code").val();
				var b = /^[a-zA-Z0-9_]{6,16}$/
				if (!user_name.match(b)) {
					api.toast({
						msg : '用户名必须是由字母和数字组成的长度为6到16位的任意组合'
					});
				} else {
					//获取用户信息
					api.ajax({
						url : window.serverUrl + 'valusername&funid=sys_user&user_code=' + user_name,
					}, function(ret, err) {
						if (ret && ret.success == false) {//请求返回success值为false时
							api.toast({
								msg : '抱歉此用户名已被使用，请更换其它用户名'
							});
							$("#user_code").focus();
						}
					});
				}
			});
			/*纳税身份选择*/
			function select() {
				api.actionSheet({
					title : '请选择纳税身份',
					buttons : ['一般纳税人', '房产经纪人']
				}, function(ret, err) {
					if (ret && ret.buttonIndex == 1) {
						$("#cole_no").attr("types", "04");
						$("#cole_no").text("一般纳税人");
					} else if (ret && ret.buttonIndex == 2) {
						$("#cole_no").attr("types", "05");
						$("#cole_no").text("房产经纪人")
					} else {
						$("#cole_no").attr("types", "04");
						$("#cole_no").text("一般纳税人");
					}
				});
			}

			/*关闭本页*/
			function gb() {
				api.closeWin({
				});
			}
		</script>
	</body>
</html>