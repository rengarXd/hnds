<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
        <title>title</title>
        <link rel="stylesheet" type="text/css" href="../../css/Hui.css"/>
        <style>
            html {
                background-color: #ffffff;
            }
            body {
                background-color: #ffffff;
            }
            span {
                color: #3F3F3F;
            }
            .H_header_bg {
                background: #0193E8
            }
            .H-theme-background-color1 {
                background-color: #1ECFF5;
            }
            .H-theme-border-color1:active {
                background: #0fc9f1;
                border: 1px solid #0fc9f1;
            }
        </style>
    </head>
    <body>
        <header class="H-header H_header_bg" id="index_header">
            <div class="H-header-title H-text-align-center H-theme-font-color-white H-center-all"></div>
        </header>
        <img src="../../image/register_header.png" style="width: 100%"/>
        <div style="margin: 0px 25px 25px 25px;" id="availdate">
            <p class="H-padding-horizontal-both-10 H-font-size-12"style="color: #C9C9C9">
                请您如实填写下列信息
            </p>
            <div class="H-flexbox-horizontal H-border-vertical-both-after">
                <span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">用户名：</span>
                <input id="user_name" type="text" data-rule="*6-16" data-nullmsg="用户名不能为空" data-errmsg="请填写6-16位任意字符" data-sucmsg="" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="输入你用于登陆的账号名">
            </div>
            <div class="H-flexbox-horizontal H-border-vertical-bottom-after">
                <span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">密码：</span>
                <input id="user_password" type="password" data-rule="*6-16" data-nullmsg="密码不能为空" data-errmsg="请填写6-16位任意字符" data-sucmsg="" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="请输入密码">
            </div>
            <div class="H-flexbox-horizontal H-border-vertical-bottom-after">
                <span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">手机号码：</span>
                <input id="phone_number" type="tel" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="请输入手机号码" >
            </div>
            <div class="H-flexbox-horizontal H-border-vertical-bottom-after">
                <span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">姓名：</span>
                <input id="user_realname" type="text" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="请输入真实姓名" >
            </div>
            <div class="H-flexbox-horizontal H-border-vertical-bottom-after">
                <span class="H-vertical-middle H-padding-horizontal-left-10 H-theme-background-color-white H-font-size-16">邮箱：</span>
                <input id="email_address" type="email" data-rule="e" data-nullmsg="" data-errmsg="邮箱地址格式不对" data-sucmsg="" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="请输入邮箱" >
            </div>
            <button id="register" onclick="register();" class="H-margin-vertical-top-10 H-button H-width-100-percent  H-font-size-15 H-outline-none H-padding-vertical-both-12 H-padding-horizontal-both-20 H-theme-background-color1 H-theme-font-color-white H-theme-border-color1 H-theme-background-color1-click H-theme-font-color1-click H-border-radius-3" style="border-color: #1ECFF5">
                注&nbsp;&nbsp;&nbsp;册
            </button>
        </div>
        <script type="text/javascript" src="../../script/H.js"></script>
        <script type="text/javascript" src="../../script/zepto.min.js"></script>
        <script type="text/javascript" src="../../script/tools/availdate-v1.0.2.js"></script>
        <script type="text/javascript">
            H.ready(function() {
                ac.form({
                    area : "#availdate",
                    btn : "#register", // 触发验证的按钮或者元素，支持标签，id，class，推荐使用id或者class
                    startCheck : function() {
                        // 自定义验证之前执行函数
                        //alert("开始验证啦！一般用于加载！");
                    },
                    singleError : function(e, msg) {
                        // 自定义弹窗格式###############
                        api.alert({
                            title : "温馨提示",
                            msg : msg
                        }, function(ret, err) {
                        });
                    },
                    singleSuccess : function(e, msg) {
                        // 验证单个成功之后提示信息
                        //alert("我自己通过验证了！别人我不知道！");
                    },
                    endSuccess : function(data) {
                        api.showProgress({
                        });
                    }
                });
            });
            //当输入密码框获取焦点时
            $("#user_password").focus(function() {
                /*用户名，密码判空*/
                //				var user_name = $("#user_name").val();
                //				if (user_name.length == 0) {
                //					api.toast({
                //						msg : '用户名不能为空'
                //					});
                //				} else {
                var u_name = $("#user_name").val();
                //获取用户信息
                api.ajax({
                    url : window.serverUrl + 'valusername&funid=app_userinfo&user_name=' + u_name,
                }, function(ret, err) {
                    if (ret && ret.success == false) {//请求返回success值为false时
                        api.toast({
                            msg : '抱歉用户名已被占用'
                        });
                        $("#user_name").focus();
                    }
                });
            });
            /*注册*/
            function register() {
                var user_name = $("#user_name").val();
                var tel = $("#phone_number").val();
                /*手机号正则*/
                var a = /^((\(\d{3}\))|(\d{3}\-))?13\d{9}|14[57]\d{8}|15\d{9}|18\d{9}$/;
                if (tel.length != 11 || !tel.match(a)) {
                    api.toast({
                        msg : '请输入正确的电话号码'
                    });
                    return;
                }
                var user_realname = $("#user_realname").val();
                var email = $("#email_address").val();
                /*邮箱正则*/
                var filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
                if (!email.match(filter)) {
                    api.toast({
                        msg : '请输入正确的邮箱'
                    });
                    return;
                }
                var user_password = $("#user_password").val();
                api.showProgress({
                    title : '注册中',
                    text : '请稍等....',
                });
                //post请求
                api.ajax({
                    url : window.serverUrl + 'register',
                    data : {
                        values : {
                            user_name : user_name,
                            phone_number : tel,
                            user_realname : user_realname,
                            email_address : email,
                            user_password : user_password
                        }
                    }
                }, function(ret, err) {
                    api.hideProgress();
                    var systemType = api.systemType;
                    if (systemType == "IOS") {
                        var rets = eval('(' + err.body + ')');
                        if (rets && rets.success == true) {
                            api.toast({
                                msg : '注册成功，即将跳转登录页面'
                            });
                            api.openWin({
                                name : 'login_body',
                                url : '../login/login_body.html'
                            });
                            //1.登录成功之后延时关闭自已
                            setTimeout(function() {
                                H.closeWin();
                            }, 1200);
                        } else if (err) {
                            api.toast({
                                msg : '注册失败'
                            });
                        }
                    } else {
                        if (ret && ret.success == true) {
                            alert("注册成功");
                            api.openWin({
                                name : 'login_body',
                                url : '../login/login_body.html'
                            });
                            //1.登录成功之后延时关闭自已
                            setTimeout(function() {
                                H.closeWin();
                            }, 1200);
                        } else if (err) {
                            api.toast({
                                msg : '注册失败'
                            });
                        }
                    }
                });
                //发送自定义广播，传递用户名和密码信息
                api.sendEvent({
                    name : 'myUser',
                    extra : {
                        user_name : user_name,
                        user_password : user_password
                    }
                });
            }
        </script>
    </body>
</html>